#!/bin/bash
set -e

ctags \
	-R \
	--exclude=build \
	--exclude=makefile \
	--exclude=TableGen \
	--exclude=Target \
	--exclude=Analysis \
	--exclude=CodeGen \
	--exclude=static \
	--exclude=generated \
	--exclude=env \
	--exclude=assets \
	--exclude=node_modules \
	--exclude=bower_components \
	.

ctags -R -a --c-kinds=+p --c++-kinds=+p \
	-I DECLSPEC \
	-I SDLCALL \
	-I SDL_PRINTF_VARARG_FUNC+ \
	-I SDL_PRINTF_FORMAT_STRING \
	/usr/include/SDL2 \
	/usr/include/openssl \
	/usr/include/x86_64-linux-gnu \
	$HOME/opt/llvm/release_40/MinSizeRel/include/llvm

case "$(uname -s)" in
    Linux)
      sed -i -E 's/^[a-zA-Z]+\.(.*)/\1/' tags
      ;;
    *)
      echo "TODO: Fix tags"
      ;;
esac

wc -l tags
ZION_TAGS=/var/tmp/tags.zion
if [ -f "lib/std.zion" ]; then
	zion ctags lib/std | sort | uniq > $ZION_TAGS
	cat $ZION_TAGS >> tags
	wc -l $ZION_TAGS
	cat tags | sort | uniq > tags.new
	mv tags.new tags
fi

echo "Tags are complete."
